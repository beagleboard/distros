image: registry.git.beagleboard.org/jkridner/debian-build:latest
# https://openbeagle.org/jkridner/debian-build

stages:
  - lint
  - deploy

lint:
  stage: lint
  before_script:
    - apt-get update && apt-get install -y jsonlint
  script:
    - jsonlint-php os_list.json

deploy:
  stage: deploy
  before_script:
    - apt-get update && apt-get install -y openssh-client
  script:
    - mkdir -p ~/.ssh
    - eval "$(ssh-agent -s)"
    - echo "${PRIVATE_KEY}" | base64 -d | ssh-add -
    - rsync -e 'scp -p 45 -o "StrictHostKeyChecking=no"' -vP os_list.json docs@beagleboard.org:/mnt/debian/distros.json
  only:
    - main
